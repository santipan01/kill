-- ===== ANTIDUPE RAYFIELD =====
pcall(function()
	for _,v in ipairs(game:GetService("CoreGui"):GetChildren()) do
		if v.Name:lower():find("rayfield") then
			v:Destroy()
		end
	end
end)

-- ===== SERVICES =====
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local lp = Players.LocalPlayer

-- ===== LOAD GUI =====
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

-- ===== STATE =====
local StealFinder = false
local GoToSteal = false
local AutoSell = false
local StealHop = false
local InstantPP = true
local StealProtector = false
local VoidSteal = false

local StealKeyword = "steal"
local SellKeyword = "sell"

local respawnCF
local lastGroundCF

-- ===== WINDOW =====
local Window = Rayfield:CreateWindow({
	Name = "Kill Game",
	LoadingTitle = "Kill Game",
	LoadingSubtitle = "Universal Kill",
	Theme = "Dark",
	ConfigurationSaving = {Enabled = false}
})

UserInputService.InputBegan:Connect(function(i,g)
	if not g and i.KeyCode == Enum.KeyCode.LeftControl then
		Rayfield:ToggleWindow()
	end
end)

-- ===== TABS =====
local Stealer = Window:CreateTab("Stealer", 4483362458)
local More = Window:CreateTab("More", 4483362458)

-- ===== UI =====
Stealer:CreateToggle({Name="Steal Finder", Callback=function(v) StealFinder=v end})
Stealer:CreateToggle({Name="Go To Steal", Callback=function(v) GoToSteal=v end})
Stealer:CreateToggle({Name="Auto Sell", Callback=function(v) AutoSell=v end})
Stealer:CreateToggle({Name="Steal Hop", Callback=function(v) StealHop=v end})
Stealer:CreateToggle({Name="Steal Protector", Callback=function(v) StealProtector=v end})
Stealer:CreateToggle({Name="Void Steal", Callback=function(v) VoidSteal=v end})

Stealer:CreateButton({
	Name="Back to Respawn",
	Callback=function()
		if respawnCF and lp.Character and lp.Character:FindFirstChild("HumanoidRootPart") then
			lp.Character.HumanoidRootPart.CFrame = respawnCF
		end
	end
})

More:CreateToggle({
	Name="Instant ProximityPrompt (ALL)",
	CurrentValue=true,
	Callback=function(v) InstantPP=v end
})

More:CreateInput({
	Name="Steal Keyword",
	PlaceholderText="steal",
	Callback=function(v)
		if v ~= "" then StealKeyword = v:lower() end
	end
})

More:CreateInput({
	Name="Sell Keyword",
	PlaceholderText="sell",
	Callback=function(v)
		if v ~= "" then SellKeyword = v:lower() end
	end
})

-- ===== CHARACTER TRACK =====
local function onChar(char)
	task.wait(1)
	local hrp = char:FindFirstChild("HumanoidRootPart")
	if hrp then
		respawnCF = hrp.CFrame
	end
end
if lp.Character then onChar(lp.Character) end
lp.CharacterAdded:Connect(onChar)

-- ===== INSTANT PROXIMITY (INCLUYE NUEVOS) =====
local Prompts = {}
local function registerPrompt(p)
	if p:IsA("ProximityPrompt") then
		if InstantPP then p.HoldDuration = 0 end
		Prompts[p] = true
	end
end

for _,v in ipairs(Workspace:GetDescendants()) do registerPrompt(v) end
Workspace.DescendantAdded:Connect(registerPrompt)

-- ===== MAIN LOGIC OPTIMIZADO PARA DELTA =====
task.spawn(function()
	while task.wait(0.5) do
		local char = lp.Character
		local hrp = char and char:FindFirstChild("HumanoidRootPart")
		local hum = char and char:FindFirstChildOfClass("Humanoid")
		local found = false

		-- actualizar lastGroundCF
		if hrp then
			local ray = Workspace:Raycast(hrp.Position, Vector3.new(0,-12,0))
			if ray then lastGroundCF = CFrame.new(ray.Position + Vector3.new(0,3,0)) end
		end

		for p,_ in pairs(Prompts) do
			if not p or not p.Parent or not p.Enabled then Prompts[p]=nil goto cont end
			local txt = ((p.Name or "")..(p.ActionText or "")..(p.ObjectText or "")):lower()
			if InstantPP then pcall(function() p.HoldDuration=0 end) end

			-- STEAL
			if txt:find(StealKeyword) then
				found = true
				if StealFinder then pcall(function() fireproximityprompt(p) end) end
				if GoToSteal and hrp then
					local part = p.Parent
					while part and not part:IsA("BasePart") do part = part.Parent end
					if part then
						hrp.CFrame = part.CFrame * CFrame.new(0,2,0)
						task.wait(0.05)
						pcall(function() fireproximityprompt(p) end)
					end
				end
			end

			-- SELL
			if AutoSell and txt:find(SellKeyword) then
				pcall(function() fireproximityprompt(p) end)
			end
			::cont::
		end

		-- StealHop
		if StealHop and not found then
			pcall(function() TeleportService:Teleport(game.PlaceId) end)
		end

		-- StealProtector (antihit+antivoid)
		if StealProtector and hrp and hum then
			if hum.MoveDirection.Magnitude == 0 then
				hrp.AssemblyLinearVelocity = Vector3.zero
				hrp.AssemblyAngularVelocity = Vector3.zero
			end
			if hrp.Position.Y < -12 then
				if lastGroundCF then hrp.CFrame = lastGroundCF
				elseif respawnCF then hrp.CFrame = respawnCF end
			end
		end

		-- VoidSteal
		if VoidSteal and hrp then
			local base = hrp.CFrame
			hrp.CFrame = base + Vector3.new(0, math.random(1,3), 0)
			task.wait(0.06)
			hrp.CFrame = base
		end
	end
end)

Rayfield:Notify({
	Title="Kill Game",
	Content="Stable version loaded with StealProtector & VoidSteal",
	Duration=3
})
